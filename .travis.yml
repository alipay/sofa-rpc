#.travis.yml
language: java

addons:
  apt:
    packages:
    - openjdk-6-jdk

jdk:
- oraclejdk8
- openjdk7
- openjdk6

before_install:
- echo "Downloading Maven 3.2.5"
  && wget https://archive.apache.org/dist/maven/maven-3/3.2.5/binaries/apache-maven-3.2.5-bin.zip
  && unzip -q apache-maven-3.2.5-bin.zip
  && export M2_HOME=$PWD/apache-maven-3.2.5
  && export PATH=$M2_HOME/bin:$PATH
  && cp ./tools/ci/.travis.settings.xml $HOME/.m2/settings.xml
  && mvn -version
- echo "Downloading Nacos 0.2.1"
  && wget https://github.com/alibaba/nacos/releases/download/0.2.1/nacos-server-0.2.1.zip
  && unzip -q nacos-server-0.2.1.zip
  && export NACOS_HOME=$PWD/nacos
  && export PATH=$NACOS_HOME/bin:$PATH

install:
- mvn clean install -Pci-install -B -U -e
- sh ./tools/check_format.sh

before_script:
- bash $NACOS_HOME/bin/startup.sh -m standalone
- sleep 10

script:
- travis_retry mvn clean package -Pci-test

after_script:
- bash $NACOS_HOME/bin/shutdown.sh

after_success:
- bash <(curl -s https://codecov.io/bash)